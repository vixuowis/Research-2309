# requirements_file --------------------

!pip install -U transformers Pillow requests

# function_import --------------------

from transformers import BlipProcessor, BlipForQuestionAnswering
from PIL import Image
import requests

# function_code --------------------

def detect_intruder(image_path, question):
    """
    Detects the intruder in the room using a CCTV image and a predefined question.

    :param image_path: str - Path to the CCTV image
    :param question: str - Question being asked to the model
    :return: str - The answer generated by the model
    """
    processor = BlipProcessor.from_pretrained('Salesforce/blip-vqa-capfilt-large')
    model = BlipForQuestionAnswering.from_pretrained('Salesforce/blip-vqa-capfilt-large')

    cctv_image = Image.open(image_path).convert('RGB')

    inputs = processor(cctv_image, question, return_tensors='pt')
    answer = model.generate(**inputs)
    return processor.decode(answer[0], skip_special_tokens=True)

# test_function_code --------------------

def test_detect_intruder():
    print("Testing detect_intruder function.")

    # Test case 1: Correct detection
    print("Testing case [1/1] started.")
    image_path = 'test_image.jpg'  # A test image file should be provided here
    question = 'Who entered the room?'
    assert detect_intruder(image_path, question) == 'A person with a red hoodie entered the room.', f"Test case [1/1] failed: The model did not correctly detect the person."

    print("Testing finished.")

# Run the test function
test_detect_intruder()