# requirements_file --------------------

!pip install -U transformers requests pillow

# function_import --------------------

from transformers import pipeline

# function_code --------------------

def generate_image_description(image_path):
    """
    Generate a text description for an image using the pre-trained model.

    Parameters:
    image_path (str): The file path to the image for which to generate a description.

    Returns:
    str: A text description generated by the model based on the image content.
    """
    # Create a text generation pipeline with the pre-trained model
    img2text_pipeline = pipeline("text-generation", model="microsoft/git-large-r-textcaps")
    
    # Read image data
    with open(image_path, "rb") as image_file:
        image_data = image_file.read()
    
    # Generate text output
    text_output = img2text_pipeline(image_data)[0]["generated_text"]
    
    return text_output

# test_function_code --------------------

from PIL import Image
import requests
from io import BytesIO

def test_generate_image_description():
    print("Testing started.")
    # Use an example image URL for testing
    image_url = "https://example.com/path_to_image.jpg"
    
    # Fetch the image data from the URL
    response = requests.get(image_url)
    image_data = BytesIO(response.content)
    
    # Save the image locally for testing purposes
    test_image_path = "test_image.jpg"
    with open(test_image_path, "wb") as f:
        f.write(image_data.getbuffer())

    # Test case 1: Verify that the function returns a string
    description = generate_image_description(test_image_path)
    assert isinstance(description, str), "Expected the output to be a string."
    
    # Test case 2: Check that the description is not empty
    assert description, "Expected non-empty description text for the image."
    
    # Clean up the test image file
    Image.open(test_image_path).close()
    import os
    os.remove(test_image_path)

    # All test cases passed
    print("Testing finished.")

# Run the test function
test_generate_image_description()