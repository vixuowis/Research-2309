{"path": "output/hf-eval-data-v3-valid/f00706_convert_text_to_speech.py", "content": "# function_import --------------------\n\nimport os\nimport soundfile\nfrom espnet2.bin.tts_inference import Text2Speech\n\n# function_code --------------------\n\ndef convert_text_to_speech(lesson_text: str, output_file: str) -> None:\n    '''\n    Convert the given text into speech using a pre-trained Chinese Text-to-Speech model.\n\n    Args:\n        lesson_text (str): The text content of the lesson.\n        output_file (str): The path to the output audio file.\n\n    Returns:\n        None\n\n    Raises:\n        ModuleNotFoundError: If the required modules are not installed.\n    '''\n    text2speech = Text2Speech.from_pretrained('espnet/kan-bayashi_csmsc_tts_train_tacotron2_raw_phn_pypinyin_g2p_phone_train.loss.best')\n    speech = text2speech(lesson_text)['wav']\n    soundfile.write(output_file, speech.numpy(), text2speech.fs, 'PCM_16')\n\n# test_function_code --------------------\n\ndef test_convert_text_to_speech():\n    '''\n    Test the convert_text_to_speech function.\n    '''\n    convert_text_to_speech('\u6c49\u8bed\u5f88\u6709\u8da3', 'lesson_audio_example.wav')\n    assert os.path.exists('lesson_audio_example.wav'), 'The audio file does not exist.'\n    os.remove('lesson_audio_example.wav')\n    assert not os.path.exists('lesson_audio_example.wav'), 'The audio file was not deleted.'\n    return 'All Tests Passed'\n\n# call_test_function_code --------------------\n\ntest_convert_text_to_speech()", "function_import": "# function_import --------------------\n\nimport os\nimport soundfile\nfrom espnet2.bin.tts_inference import Text2Speech\n\n", "function_code": "# function_code --------------------\n\ndef convert_text_to_speech(lesson_text: str, output_file: str) -> None:\n    '''\n    Convert the given text into speech using a pre-trained Chinese Text-to-Speech model.\n\n    Args:\n        lesson_text (str): The text content of the lesson.\n        output_file (str): The path to the output audio file.\n\n    Returns:\n        None\n\n    Raises:\n        ModuleNotFoundError: If the required modules are not installed.\n    '''\n    text2speech = Text2Speech.from_pretrained('espnet/kan-bayashi_csmsc_tts_train_tacotron2_raw_phn_pypinyin_g2p_phone_train.loss.best')\n    speech = text2speech(lesson_text)['wav']\n    soundfile.write(output_file, speech.numpy(), text2speech.fs, 'PCM_16')\n\n", "test_function_code": "# test_function_code --------------------\n\ndef test_convert_text_to_speech():\n    '''\n    Test the convert_text_to_speech function.\n    '''\n    convert_text_to_speech('\u6c49\u8bed\u5f88\u6709\u8da3', 'lesson_audio_example.wav')\n    assert os.path.exists('lesson_audio_example.wav'), 'The audio file does not exist.'\n    os.remove('lesson_audio_example.wav')\n    assert not os.path.exists('lesson_audio_example.wav'), 'The audio file was not deleted.'\n    return 'All Tests Passed'\n\n", "call_test_function_code": "# call_test_function_code --------------------\n\ntest_convert_text_to_speech()", "instruct": "# function_import --------------------\n\nimport os\nimport soundfile\nfrom espnet2.bin.tts_inference import Text2Speech\n\n# function_code --------------------\n\ndef convert_text_to_speech(lesson_text: str, output_file: str) -> None:\n    '''\n    Convert the given text into speech using a pre-trained Chinese Text-to-Speech model.\n\n    Args:\n        lesson_text (str): The text content of the lesson.\n        output_file (str): The path to the output audio file.\n\n    Returns:\n        None\n\n    Raises:\n        ModuleNotFoundError: If the required modules are not installed.\n    '''", "answer": "\n    text2speech = Text2Speech.from_pretrained('espnet/kan-bayashi_csmsc_tts_train_tacotron2_raw_phn_pypinyin_g2p_phone_train.loss.best')\n    speech = text2speech(lesson_text)['wav']\n    soundfile.write(output_file, speech.numpy(), text2speech.fs, 'PCM_16')\n\n", "prediction": "\n\n    model_path = os.environ['MODEL_PATH']\n    if model_path is None:\n        raise ValueError('The environment variable MODEL_PATH must be defined and point to a valid pre-trained Chinese TTS model.')\n        \n    hifigan_model_file = os.path.join(model_path, 'hifigan_tacotron2.pt')\n    vocoder_config_file = os.path.join(model_path, 'hifigan.yaml')\n    token_list = os.path.join(model_path, 'token_list')\n\n    text2speech = Text2Speech(\n        train_config=None,\n        model_file=hifigan_model_file,\n        vocoder_config=vocoder_config_file,\n        token_list=token_list,\n        use_feats_extract=False,\n        normalize_output_wav=True,\n    )\n    \n    output = text2speech(lesson_text)['wav']\n    \n    with soundfile.SoundFile(output_file, 'w', samplerate=text2speech.fs, channels=1) as f:\n        f.write(output.view(-1).numpy())"}